" 1. Locked → skip both and release lock immediately
IF lv_locked_active = abap_true.
  lv_stat = 'I0043'.

  " Prepare output but skip BAPI and CPI
  PERFORM f_prepare_output USING ps_order lv_vornr lv_stat.
  gs_output-msg = 'Locked – skip BAPI and CMX (program exited for this order)'.

  " Append message if not existing
  READ TABLE gt_output WITH KEY MaintenanceOrder = ps_order-aufnr TRANSPORTING NO FIELDS.
  IF sy-subrc <> 0.
    APPEND gs_output TO gt_output.
  ENDIF.

  " Explicitly release any SAP lock on this order (if held)
  CALL FUNCTION 'DEQUEUE_E_AUFNR'
    EXPORTING
      aufnr = ps_order-aufnr.

  " Exit immediately for this order — no further logic runs
  RETURN.
ENDIF.