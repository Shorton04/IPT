*-------------------------------------------------------------*
*  END-OF-SELECTION
*-------------------------------------------------------------*
END-OF-SELECTION.

  IF gt_output IS INITIAL.
    WRITE: / 'No matching orders found.'.
    EXIT.
  ENDIF.

  "-------------------------------------------------------
  " Send data and update statuses (if not test mode)
  "-------------------------------------------------------
  IF p_test IS INITIAL.
    PERFORM f_send_cmx.          "Update user status CMXS if needed
    PERFORM f_send_to_cpi.       "Send JSON payload to CPI
  ENDIF.

  "-------------------------------------------------------
  " Show only those actually sent to CMX (based on message)
  "-------------------------------------------------------
  DELETE gt_output WHERE msg NOT CP '*sent*'
                     AND msg NOT CP '*CPI success*'
                     AND msg NOT CP '*CPI error*'
                     AND msg NOT CP '*Locked*'
                     AND msg NOT CP '*Unlocked*'.

  IF gt_output IS INITIAL.
    WRITE: / 'No orders were sent to CMX.'.
  ELSE.
    PERFORM f_display.
  ENDIF.